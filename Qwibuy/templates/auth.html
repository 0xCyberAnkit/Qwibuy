<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login / Sign Up</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" xintegrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #a78bfa, #818cf8, #3b82f6);
            background-size: 200% 200%;
            animation: gradient-flow 10s ease infinite alternate;
        }
        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800 antialiased flex items-center justify-center min-h-screen">
    <!-- Login/Signup Container -->
    <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full m-4 transform transition-transform hover:scale-105 duration-300">
        <div id="login-form-container">
            <h3 class="text-3xl font-bold text-gray-900 mb-6 text-center">Welcome Back</h3>
            <form id="login-form" class="space-y-4" method='post'>
                {% csrf_token %}
                <div class="flex flex-col">
                    <label for="login-email" class="text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="login-email" class="mt-1 p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-colors" required>
                </div>
                <div class="flex flex-col">
                    <label for="login-password" class="text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="login-password" class="mt-1 p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-colors" required>
                </div>
                <div id="login-error" class="text-red-500 text-sm hidden"></div>
                <button type="submit" id="login-button" class="w-full bg-indigo-600 text-white p-3 rounded-xl font-semibold hover:bg-indigo-700 transition duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 flex items-center justify-center transform hover:scale-105">
                    <span id="login-button-text">Log In</span>
                    <div id="login-spinner" class="spinner w-5 h-5 ml-2 hidden"></div>
                </button>
            </form>
            <div class="text-center mt-6">
                <p class="text-sm text-gray-600">Don't have an account? <a href="#" id="show-signup" class="text-indigo-600 font-semibold hover:underline transition-colors">Sign Up</a></p>
            </div>
        </div>

        <div id="signup-form-container" class="hidden">
            <h3 class="text-3xl font-bold text-gray-900 mb-6 text-center">Create Account</h3>
            <form id="signup-form" class="space-y-4" method='post'>
                {% csrf_token %}
                <div class="flex flex-col">
                    <label for="user" class="text-sm font-medium text-gray-700">Name</label>
                    <input type="text" id="user" class="mt-1 p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-colors" required>
                </div>
                <div class="flex flex-col">
                    <label for="signup-email" class="text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="signup-email" class="mt-1 p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-colors" required>
                </div>
                <div class="flex flex-col">
                    <label for="signup-password" class="text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="signup-password" class="mt-1 p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-colors" required>
                </div>
                <div class="flex flex-col">
                    <label for="signup-confirm-password" class="text-sm font-medium text-gray-700">Confirm Password</label>
                    <input type="password" id="signup-confirm-password" class="mt-1 p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition-colors" required>
                </div>
                <div id="signup-error" class="text-red-500 text-sm hidden"></div>
                <button type="submit" id="signup-button" class="w-full bg-indigo-600 text-white p-3 rounded-xl font-semibold hover:bg-indigo-700 transition duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 flex items-center justify-center transform hover:scale-105">
                    <span id="signup-button-text">Sign Up</span>
                    <div id="signup-spinner" class="spinner w-5 h-5 ml-2 hidden"></div>
                </button>
            </form>
            <div class="text-center mt-6">
                <p class="text-sm text-gray-600">Already have an account? <a href="#" id="show-login" class="text-indigo-600 font-semibold hover:underline transition-colors">Log In</a></p>
            </div>
        </div>

        <div class="text-center mt-8">
            <a href="/" class="text-sm text-gray-500 hover:text-gray-700 transition-colors">‚Üê Back to Homepage</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginFormContainer = document.getElementById('login-form-container');
            const signupFormContainer = document.getElementById('signup-form-container');
            const showSignupLink = document.getElementById('show-signup');
            const showLoginLink = document.getElementById('show-login');

            if (showSignupLink) {
                showSignupLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    loginFormContainer.classList.add('hidden');
                    signupFormContainer.classList.remove('hidden');
                });
            }

            if (showLoginLink) {
                showLoginLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    loginFormContainer.classList.remove('hidden');
                    signupFormContainer.classList.add('hidden');
                });
            }

            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const loginError = document.getElementById('login-error');
            const signupError = document.getElementById('signup-error');
            const loginSpinner = document.getElementById('login-spinner');
            const signupSpinner = document.getElementById('signup-spinner');
            const loginButtonText = document.getElementById('login-button-text');
            const signupButtonText = document.getElementById('signup-button-text');

            if (loginForm) {
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    loginError.classList.add('hidden');
                    loginButtonText.textContent = '';
                    loginSpinner.classList.remove('hidden');

                    setTimeout(() => {
                        console.log('Login form submitted!');
                        loginError.classList.add('hidden');
                        showToast("Login Failed!", 'failed');
                        loginButtonText.textContent = 'Log In';
                        loginSpinner.classList.add('hidden');
                    }, 1500);
                });
            }

            if (signupForm) {
                signupForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    signupError.classList.add('hidden');
                    signupButtonText.textContent = '';
                    signupSpinner.classList.remove('hidden');

                    const password = document.getElementById('signup-password').value;
                    const confirmPassword = document.getElementById('signup-confirm-password').value;

                    if (password !== confirmPassword) {
                        signupError.textContent = "Passwords do not match.";
                        signupError.classList.remove('hidden');
                        signupButtonText.textContent = 'Sign Up';
                        signupSpinner.classList.add('hidden');
                        return;
                    }

                    setTimeout(() => {
                        console.log('Signup form submitted!');
                        signupError.classList.add('hidden');
                        showToast("Sign up successful!", 'success');
                        signupButtonText.textContent = 'Sign Up';
                        signupSpinner.classList.add('hidden');
                    }, 1500);
                });
            }
        });

        function showToast(message, type) {
            const toast = document.createElement('div');
            const colorClass = type === 'success' ? 'bg-green-500' : 'bg-red-500';

            toast.classList.add(
                'fixed', 'top-8', 'left-1/2', '-translate-x-1/2', 'text-white', 'p-4', 'rounded-lg',
                'shadow-lg', 'z-50', 'text-center', 'max-w-sm', 'transition-all', 'duration-300',
                'ease-out', 'transform', 'scale-0', 'opacity-0', colorClass
            );
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.remove('scale-0', 'opacity-0');
                toast.classList.add('scale-100', 'opacity-100');
            }, 10);

            setTimeout(() => {
                toast.classList.remove('scale-100', 'opacity-100');
                toast.classList.add('scale-0', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        $(document).on('submit','#login-form',function(e){
            e.preventDefault();
            $.ajax({
                type:'POST',

                data:{
                    csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
                    action: 'post',
                    email: $('#login-email').val(),
                    password: $('#login-password').val(),
                    mode: 'login'
                },
                success:function(json){
                    console.log(json);
                    if (json.verified){
                        location.replace("https://qwibuy.pythonanywhere.com/");
                    }
                    else{
                        console.log(json);
                        console.log('hello');
                    }
                },
                error:function(xhr,errmsg,err){
                    console.log(xhr.status + ": " + xhr.responseText);
                }
            });
        });

        $(document).on('submit','#signup-form',function(e){
            e.preventDefault();
            $.ajax({
                type:'POST',

                data:{
                    csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
                    action: 'post',
                    name: $('#user').val(),
                    email: $('#signup-email').val(),
                    password: $('#signup-password').val(),
                    repass: $('#signup-confirm-password').val(),
                    mode: 'signup'
                },
                success:function(json){
                    if(json.success){
                        $("#error").html("")
                        $("#accountcondition").html("Account Created Successfully.")
                        console.log("0")
                    }
                    else{
                        if(json.error == "accounterror"){
                            $("#error").html("")
                            $("#accountcondition").html("This Account already Exists.")
                            console.log("1")
                        }
                        else if(json.error == "passworderror"){
                            $("#accountcondition").html("")
                            $("#error").html("Please Check The Password Again.")
                            console.log("2")
                        }
                        else if(json.error == "emailerror"){
                            $("#accountcondition").html("")
                            $("#error").html("This Email is already Registered.")
                            console.log("3")
                        }
                        else if(json.error == "usernameerror"){
                            $("#accountcondition").html("")
                            $("#error").html("This Username is already Taken.")
                            console.log("4")
                        }
                        else{
                            $("#error").html("")
                            $("#accountcondition").html("Unexpected Error Occured.")
                        }
                    }
                    console.log(json);
                    console.log("success")
                },
                error:function(xhr,errmsg,err){
                    console.log(xhr.status + ": " + xhr.responseText);
                }
            });
        });
    </script>
</body>
</html>